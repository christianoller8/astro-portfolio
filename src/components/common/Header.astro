---
import ThemeToggle from './ThemeToggle.astro';

const pathname = Astro.url.pathname;

const links = [
  { href: '/', label: 'Inicio' },
  { href: '/projects', label: 'Proyectos' },
  { href: '/about', label: 'Sobre mÃ­' },
  { href: '/contact', label: 'Contacto' },
];

// Helper: Determine active state for desktop links
const getLinkClass = (path: string) => {
  const isActive = path === '/' ? pathname === '/' : pathname.startsWith(path);
  return isActive
    ? 'text-sm text-primary font-bold uppercase tracking-wide transition-colors'
    : 'text-sm text-secondary hover:text-primary hover:font-bold uppercase tracking-wide transition-colors';
};

// Helper: Determine active state for mobile links
const getMobileLinkClass = (path: string) => {
  const isActive = path === '/' ? pathname === '/' : pathname.startsWith(path);
  return isActive
    ? 'transition-colors text-foreground font-semibold'
    : 'transition-colors hover:text-foreground/80 text-foreground/60';
};
---

<header
  class="border-accent sticky top-0 z-50 w-full border-b bg-transparent backdrop-blur dark:border-neutral-800 dark:bg-neutral-950/90 dark:supports-backdrop-filter:bg-neutral-950/60"
>
  <div
    class="mx-auto flex h-16 w-full max-w-[1400px] items-center justify-end px-6 md:px-12 lg:px-20"
  >
    <nav class="hidden md:block">
      <ul class="flex items-center gap-2">
        {
          links.map((link, index) => (
            <li class="flex items-center gap-2">
              <a href={link.href} class={getLinkClass(link.href)}>
                {link.label}
              </a>
              {/* Separator Slash */}
              {index < links.length - 1 && (
                <span class="text-accent select-none" aria-hidden="true">
                  /
                </span>
              )}
            </li>
          ))
        }
      </ul>
    </nav>

    <div class="ml-4 hidden md:block">
      <ThemeToggle />
    </div>

    <div class="flex items-center gap-2 md:hidden">
      <ThemeToggle />
      <button id="mobile-menu-btn" class="text-secondary hover:text-primary p-2" aria-label="Menu">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-menu"
          ><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"
          ></line><line x1="4" x2="20" y1="18" y2="18"></line></svg
        >
      </button>
    </div>
  </div>

  <div
    id="mobile-menu"
    class="bg-background hidden border-t md:hidden dark:border-neutral-800 dark:bg-neutral-950"
  >
    <nav class="container flex flex-col gap-4 p-4 text-sm font-medium">
      {
        links.map((link) => (
          <a href={link.href} class={getMobileLinkClass(link.href)}>
            {link.label}
          </a>
        ))
      }
    </nav>
  </div>
</header>

<script>
  
  document.addEventListener('astro:page-load', () => {
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileLinks = mobileMenu?.querySelectorAll('a');

    if (mobileMenuBtn && mobileMenu) {

      const toggleMenu = () => {
        mobileMenu.classList.toggle('hidden');
      };

      mobileMenuBtn.onclick = toggleMenu;

      mobileLinks?.forEach((link) => {
        link.addEventListener('click', () => {
          mobileMenu.classList.add('hidden');
        });
      });
    }
  });
</script>
